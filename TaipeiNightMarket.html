<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <title>台北夜市查詢</title>
    <script src="https://code.jquery.com/jquery-3.4.0.js"></script>
  </head>
  <body>
      <style>
      body{
        background-color: #17181c;
        color:rgb(182, 182, 182);
        background: url(images/star.jpg)
      }
      header{
        margin: 9px;
        text-align: center;
      }
      #choice{
        color: rgb(92, 143, 255);
      }
      .listTitle{
        display: flex;
        text-align: left;
        border-bottom: 1px rgb(145, 145, 145) solid;
        width: 660px;
        height: 33px;
        font-weight: bold;
        margin: 6px
      }
      select{
        padding: 3px;
        background-color: #17181c;
        color:rgb(182, 182, 182);
        outline: none;
      }
      .name{
        flex:none;
        width:300px;
      }
      .food{
        flex:none;
        width: 360px;
      }
      #map {
        flex: none;
        margin: 9px;
        width: 360px;
        height: 360px; 
      }
      @media (max-width:1200px){
        #map{
          margin: auto;
        }
        .list{
          margin: auto;
        }
      }
      .article{
        display: flex;
        flex-wrap: wrap;
      }
      .listEach{
        display: flex;
        padding: 6px;
        border-bottom: 1px rgb(145, 145, 145) solid;
        text-align: left;
        width: 660px;
      }
      #NightMarket {
        padding: 6px;
        width: 660px;
      }
      </style>
    <header>
    <h1>台北夜市</h1>
    <a id='choice'>請選擇夜市名稱:</a>
      <select  id="mySelect" onchange="information();myFunction()">
        <option value ="請選擇">請選擇</option>
        <option value ="大龍街夜市">大龍街夜市</option>
        <option value ="廣州街觀光夜市">廣州街觀光夜市</option>
        <option value="華西街觀光夜市">華西街觀光夜市</option>
        <option value="景美夜市">景美夜市</option>
        <option value="臨江街觀光夜市">臨江街觀光夜市</option>
        <option value="遼寧街夜市">遼寧街夜市</option>
        <option value="南機場夜市">南機場夜市</option>
        <option value="寧夏觀光夜市">寧夏觀光夜市</option>
        <option value="饒河街觀光夜市">饒河街觀光夜市</option>
        <option value="雙城街夜市">雙城街夜市</option>
        <option value="士林觀光夜市">士林觀光夜市</option>
        <option value="梧州街觀光夜市">梧州街觀光夜市</option>
        <option value="西昌街觀光夜市">西昌街觀光夜市</option>
        <option value="延三觀光夜市">延三觀光夜市</option>
        <option value="梧州街觀光夜市">梧州街觀光夜市</option>
      </select>
    </header>
    <div class="article">
    <div id="map"></div>
    <div class="list">
      <div id="NightMarket"></div>
      <div class="listTitle">
        <div class="name">攤位名稱</div>
        <div class="food">特色美食</div>
      </div>
      <div id="listContent"></div>
    </div>
  </div>
    
    
    <script type="text/javascript">
      function initMap() {
          //設定中心點座標
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: 25.0477505, lng: 121.5170599}
        });
        //顯示各區的點
        var data =[
          {
            position: {lat: 25.088650, lng: 121.524396},
            map: map,
            title: '士林觀光夜市'
          },
          {
            position: {lat: 25.055955, lng: 121.515059},
            map: map,
            title: '寧夏觀光夜市'
          },
          {
            position: {lat: 25.038608, lng: 121.498443 },
            map: map,
            title: '華西街觀光夜市'
          },
          {
            position: {lat: 25.036760, lng: 121.497592},
            map: map,
            title: '廣州街觀光夜市'
          },
          {
            position: {lat:25.036341,  lng: 121.497596},
            map: map,
            title: '梧州街觀光夜市'
          },
          {
            position: {lat: 25.036768, lng: 121.500560 },
            map: map,
            title: '西昌街觀光夜市'
          },
          {
            position: {lat: 25.029151, lng:  121.505872},
            map: map,
            title: '南機場夜市'
          },
          {
            position: {lat: 24.991503, lng: 121.541845},
            map: map,
            title: '景美夜市'
          },
          {
            position: {lat: 25.050915, lng:  121.577515},
            map: map,
            title: '饒河街觀光夜市'
          },
          {
            position: {lat: 25.030215,  lng:121.554209},
            map: map,
            title: '臨江街觀光夜市'
          },
          {
            position: {lat: 25.067854,   lng:121.515871},
            map: map,
            title: '大龍街夜市'
          },
          {
            position: {lat: 25.063353,  lng: 121.511152},
            map: map,
            title: '延三觀光夜市'
          },
          {
            position: {lat: 25.049081,  lng: 121.542153},
            map: map,
            title: '遼寧街夜市'
          },
          {
            position: {lat: 25.064292,  lng: 121.524372},
            map: map,
            title: '雙城街夜市'
          },
        ]
        //跑迴圈依序將值塞入到 marker
        for(let marker = [], i=0;i<data.length;i++){
          marker[i] = new google.maps.Marker(data[i]);
          console.log(marker[i].title)
          marker[i].addListener('click', function() {
            map.setZoom(15);
            map.setCenter(marker[i].getPosition());
            document.getElementById("mySelect").value = marker[i].title
            information();
            myFunction();
          });
          document.getElementById("mySelect").addEventListener("change",function(){
            if(document.getElementById("mySelect").value == marker[i].title){
              map.setZoom(15);
              map.setCenter(marker[i].getPosition());
            }else if(document.getElementById("mySelect").value == "請選擇"){
              map.setZoom(12);
              map.setCenter({lat: 25.0477505, lng: 121.5170599})
            }
          })
        }
      }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDy7niYo3hKVoLoxDPCbZqRZWG_x7jml4k&callback=initMap">
  </script>
      <script>
        function information(){
          $("#listContent").empty();
          $("#NightMarket").empty();
          $.ajax({
            url: 'https://data.taipei/api/getDatasetInfo/downloadResource?id=8a569b5b-0cb1-4c7f-a064-780b3301354c&rid=9744ea1c-aafb-471c-8bb8-04f398ad415a',
            dataType: 'json',
          })
          .done(function(info) {
            for(i=0;i<15;i++){
              if(info[i].夜市名稱 == document.getElementById("mySelect").value){
                if(info[i].交通資訊 != null){
                  $('#NightMarket').append("夜市名稱:"+ info[i].夜市名稱 +"<br/>"+"</div>"+"<div>" + "交通資訊:" +info[i].交通資訊+"<br/>" +"所在位置:"+ info[i].所在位置+"<br/>"+ "營業時間:"+ info[i].營業時間);
                }else{
                  $('#NightMarket').append("夜市名稱:"+ info[i].夜市名稱 +"<br/>"+"</div>"+"<div>" + "交通資訊:"+"<br/>" +"所在位置:"+ info[i].所在位置+"<br/>"+ "營業時間:"+ info[i].營業時間);
                }
              } 
            }
          })
        }
        
        function myFunction(){
          $.ajax({
            url: 'https://data.taipei/api/getDatasetInfo/downloadResource?id=8a569b5b-0cb1-4c7f-a064-780b3301354c&rid=da4a214f-0c3d-437e-9312-34e5671db2a8',
            dataType: 'json',
          })
          .done(function(msg) {
            for(i=0;i<965;i++){
              if(msg[i].夜市名稱 == document.getElementById("mySelect").value){
              $('#listContent').append("<div class='listEach'>"+"<div class='name'>"+ msg[i].攤位名稱+"</div>"+"<div class='food'>"+ msg[i].其他相關產品 + "</div>"+ "</div>");
              } 
            }
          })
        }
      </script>
  </body>
</html>